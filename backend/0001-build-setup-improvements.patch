From 2ad58e37516f4327a3d99e79506710e07c874e1e Mon Sep 17 00:00:00 2001
From: Edmunt Pienkowsky <roed@onet.eu>
Date: Sat, 15 Feb 2020 08:49:26 +0100
Subject: [PATCH 1/2] build: setup improvements


diff --git a/build.go b/build.go
index 45e1bff35a..7d2a04b49d 100644
--- a/build.go
+++ b/build.go
@@ -108,7 +108,9 @@ func main() {
 	for _, cmd := range flag.Args() {
 		switch cmd {
 		case "setup":
-			setup()
+			for _, binary := range binaries {
+				doSetup("./pkg/cmd/"+binary)
+			}
 
 		case "build-srv", "build-server":
 			clean()
@@ -218,12 +220,12 @@ func genPackageVersion() string {
 	}
 }
 
-func setup() {
+func doSetup(binaryName string) {
 	args := []string{"install", "-v"}
 	if goos == windows {
 		args = append(args, "-buildmode=exe")
 	}
-	args = append(args, "./pkg/cmd/grafana-server")
+	args = append(args, binaryName)
 	runPrint("go", args...)
 }
 
@@ -361,7 +363,7 @@ func getGitBranch() string {
 func getGitSha() string {
 	v, err := runError("git", "rev-parse", "--short", "HEAD")
 	if err != nil {
-		return "unknown-dev"
+		return os.Getenv("GRAFANA_COMMIT")
 	}
 	return string(v)
 }
